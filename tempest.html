<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempest Node Builder - Diablo Immortal</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .node-connector { stroke: #475569; stroke-width: 2; opacity: 0.5; }
        .node-card { transition: transform 0.1s, box-shadow 0.2s; }
        .node-card:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 0 15px rgba(56, 189, 248, 0.5); }
        .glow-text { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .modal-overlay { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(2px); }
        /* Diablo-esque rarity colors */
        .rarity-legendary { border-color: #f59e0b; color: #f59e0b; }
        .rarity-set { border-color: #22c55e; color: #22c55e; }
        .rarity-rare { border-color: #eab308; }
        .rarity-magic { border-color: #3b82f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- DATA DEFINITIONS ---

        const SKILLS = [
            { name: "Water Edge (Primary)", type: "Primary", damagePct: 100 },
            { name: "Wind Edge (Primary)", type: "Primary", damagePct: 105 },
            { name: "Rolling Surf", type: "Water", damagePct: 150, cooldown: 8 },
            { name: "Flowing Strike", type: "Water", damagePct: 180, cooldown: 10 },
            { name: "Vortex", type: "Water", damagePct: 60, cooldown: 12, isDot: true },
            { name: "Breaker", type: "Water", damagePct: 220, cooldown: 14 },
            { name: "Zephyr Surge", type: "Wind", damagePct: 300, cooldown: 20 },
            { name: "Blade Dance", type: "Wind", damagePct: 140, cooldown: 9 },
            { name: "Cascade", type: "Water", damagePct: 250, cooldown: 12 },
            { name: "Crosswinds", type: "Wind", damagePct: 110, cooldown: 8 },
            { name: "Fog Step", type: "Wind", damagePct: 0, cooldown: 15, buff: true },
            { name: "Riptide", type: "Water", damagePct: 130, cooldown: 12 },
            { name: "Squall", type: "Wind", damagePct: 160, cooldown: 10 },
            { name: "Stormfury", type: "Wind", damagePct: 50, buff: true },
            { name: "Tidal Rush", type: "Water", damagePct: 190, cooldown: 12 },
        ];

        const SET_ITEMS = [
            "Vithu's Urges", "Gloomguide's Prize", "Grace of the Flagellant", 
            "Shepherd's Call to Wolves", "War Rags of Shal'baas", "Untouchable Mountebank",
            "Issatar Imbued", "Feasting Baron's Pack", "Windloft Perfection", "Seeds of Sown Gold",
            "Angmet's Conflagration", "Banquet of Eyes"
        ];

        const GEMS_LEGENDARY = [
            "Blood-Soaked Jade", "Seeping Bile", "Bottled Hope", "Gloom Cask", 
            "Roiling Consequence", "Starfire Shard", "Void Spark", "Mother's Lament",
            "Viper's Bite", "Pain Clasp", "Berserker's Eye", "Ca'arsen's Invigoration"
        ];

        const CURSED_PROPERTIES = [
            "None", "Lashed", "Atrophied", "Tortured", "Netted", "Phantom", "Detested"
        ];

        const INITIAL_LAYOUT = {
            // Main Gear
            "head": { x: 400, y: 100, label: "Head", type: "main" },
            "chest": { x: 400, y: 200, label: "Chest", type: "main" },
            "shoulders": { x: 300, y: 150, label: "Shoulders", type: "main" },
            "legs": { x: 500, y: 150, label: "Legs", type: "main" },
            "mainHand": { x: 250, y: 300, label: "Main Hand", type: "main" },
            "offHand": { x: 550, y: 300, label: "Off Hand", type: "main" },
            "mainHand2": { x: 200, y: 400, label: "Stance MH", type: "main" },
            "offHand2": { x: 600, y: 400, label: "Stance OH", type: "main" },
            // Secondary Gear
            "neck": { x: 400, y: 500, label: "Neck", type: "secondary" },
            "waist": { x: 400, y: 580, label: "Waist", type: "secondary" },
            "hands": { x: 300, y: 540, label: "Hands", type: "secondary" },
            "feet": { x: 500, y: 540, label: "Feet", type: "secondary" },
            "ring1": { x: 250, y: 600, label: "Ring 1", type: "secondary" },
            "ring2": { x: 550, y: 600, label: "Ring 2", type: "secondary" },
            "bracelet1": { x: 200, y: 680, label: "Bracelet 1", type: "secondary" },
            "bracelet2": { x: 600, y: 680, label: "Bracelet 2", type: "secondary" },
            // Skills (Radial Left)
            "primary": { x: 100, y: 100, label: "Primary", type: "skill" },
            "skill1": { x: 50, y: 180, label: "Skill 1", type: "skill" },
            "skill2": { x: 50, y: 260, label: "Skill 2", type: "skill" },
            "skill3": { x: 50, y: 340, label: "Skill 3", type: "skill" },
            "skill4": { x: 100, y: 420, label: "Skill 4", type: "skill" },
            // Paragon (Radial Right)
            "paragon": { x: 700, y: 100, label: "Paragon", type: "paragon" },
        };

        const DEFAULT_ITEM = {
            name: "New Item",
            essence: "",
            set: "",
            cr: 1500,
            resonance: 0,
            gem1: null,
            gem2: null,
            gem3: null,
            rune: null,
            curse: "None",
            magic: []
        };

        // --- COMPONENTS ---

        const App = () => {
            const [loadout, setLoadout] = useState(() => {
                const saved = localStorage.getItem('tempest_loadout');
                if (saved) return JSON.parse(saved);
                
                const initial = {};
                Object.keys(INITIAL_LAYOUT).forEach(key => {
                    initial[key] = { ...DEFAULT_ITEM, id: key, type: INITIAL_LAYOUT[key].type };
                });
                return initial;
            });

            const [selectedNode, setSelectedNode] = useState(null);
            const [scale, setScale] = useState(1);
            const [pan, setPan] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const [testerOpen, setTesterOpen] = useState(false);

            // Auto-save
            useEffect(() => {
                localStorage.setItem('tempest_loadout', JSON.stringify(loadout));
            }, [loadout]);

            const handleUpdateNode = (id, updates) => {
                setLoadout(prev => ({
                    ...prev,
                    [id]: { ...prev[id], ...updates }
                }));
            };

            const handleWheel = (e) => {
                const newScale = Math.min(Math.max(0.5, scale - e.deltaY * 0.001), 2);
                setScale(newScale);
            };

            const handleMouseDown = (e) => {
                if (e.target.closest('.node-card')) return;
                setIsDragging(true);
                setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                setPan({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y });
            };

            const handleMouseUp = () => setIsDragging(false);

            // File IO
            const saveToFile = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(loadout));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "tempest_build.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const loadFromFile = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsed = JSON.parse(event.target.result);
                        setLoadout(parsed);
                    } catch (err) {
                        alert("Invalid JSON file");
                    }
                };
                reader.readAsText(file);
            };

            // Stats Calculation
            const stats = useMemo(() => {
                let totalCR = 0;
                let totalRes = 0;
                let setCounts = {};
                
                Object.values(loadout).forEach(item => {
                    if (item.type === 'main' || item.type === 'secondary') {
                        totalCR += parseInt(item.cr) || 0;
                        totalRes += parseInt(item.resonance) || 0;
                        if (item.set) {
                            setCounts[item.set] = (setCounts[item.set] || 0) + 1;
                        }
                    }
                });
                return { totalCR, totalRes, setCounts };
            }, [loadout]);

            return (
                <div 
                    className="w-screen h-screen bg-slate-900 text-white overflow-hidden relative"
                    onWheel={handleWheel}
                    onMouseDown={handleMouseDown}
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                >
                    {/* Background Grid */}
                    <div 
                        className="absolute inset-0 opacity-10 pointer-events-none"
                        style={{
                            backgroundImage: 'radial-gradient(#475569 1px, transparent 1px)',
                            backgroundSize: '20px 20px',
                            transform: `translate(${pan.x}px, ${pan.y}px) scale(${scale})`
                        }}
                    />

                    {/* Toolbar */}
                    <div className="absolute top-0 left-0 right-0 p-4 bg-slate-800/80 backdrop-blur flex justify-between items-center z-50 border-b border-slate-700">
                        <div className="flex items-center gap-4">
                            <h1 className="text-2xl font-bold text-cyan-400 tracking-wider uppercase">Tempest<span className="text-white text-sm ml-2 opacity-70">Builder</span></h1>
                            <div className="flex gap-4 text-sm text-slate-300 bg-slate-900/50 px-4 py-2 rounded-lg border border-slate-700">
                                <span><i className="fas fa-shield-alt text-yellow-500 mr-2"></i>CR: <span className="text-white font-mono">{stats.totalCR}</span></span>
                                <span><i className="fas fa-gem text-purple-500 mr-2"></i>Resonance: <span className="text-white font-mono">{stats.totalRes}</span></span>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setTesterOpen(true)} className="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded text-sm font-bold transition"><i className="fas fa-bolt mr-2"></i>Test Skills</button>
                            <button onClick={saveToFile} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm transition"><i className="fas fa-save mr-2"></i>Save JSON</button>
                            <label className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-sm transition cursor-pointer">
                                <i className="fas fa-upload mr-2"></i>Load JSON
                                <input type="file" className="hidden" accept=".json" onChange={loadFromFile} />
                            </label>
                        </div>
                    </div>

                    {/* Canvas Area */}
                    <div 
                        className="absolute inset-0 transform-gpu"
                        style={{ transform: `translate(${pan.x}px, ${pan.y}px) scale(${scale})` }}
                    >
                        <svg className="absolute top-0 left-0 w-[2000px] h-[2000px] pointer-events-none overflow-visible">
                            {/* Draw lines from core (Head/Chest area) to others for visual structure */}
                            <line x1={INITIAL_LAYOUT.chest.x + 64} y1={INITIAL_LAYOUT.chest.y + 32} x2={INITIAL_LAYOUT.head.x + 64} y2={INITIAL_LAYOUT.head.y + 64} className="node-connector" />
                            <line x1={INITIAL_LAYOUT.chest.x + 64} y1={INITIAL_LAYOUT.chest.y + 32} x2={INITIAL_LAYOUT.shoulders.x + 64} y2={INITIAL_LAYOUT.shoulders.y + 64} className="node-connector" />
                            <line x1={INITIAL_LAYOUT.chest.x + 64} y1={INITIAL_LAYOUT.chest.y + 32} x2={INITIAL_LAYOUT.legs.x + 64} y2={INITIAL_LAYOUT.legs.y + 64} className="node-connector" />
                            <line x1={INITIAL_LAYOUT.chest.x + 64} y1={INITIAL_LAYOUT.chest.y + 32} x2={INITIAL_LAYOUT.mainHand.x + 64} y2={INITIAL_LAYOUT.mainHand.y + 64} className="node-connector" />
                            <line x1={INITIAL_LAYOUT.chest.x + 64} y1={INITIAL_LAYOUT.chest.y + 32} x2={INITIAL_LAYOUT.offHand.x + 64} y2={INITIAL_LAYOUT.offHand.y + 64} className="node-connector" />
                            {/* Skill Connections */}
                            <line x1={INITIAL_LAYOUT.chest.x} y1={INITIAL_LAYOUT.chest.y} x2={INITIAL_LAYOUT.skill2.x + 128} y2={INITIAL_LAYOUT.skill2.y + 32} className="node-connector" />
                        </svg>

                        {Object.entries(INITIAL_LAYOUT).map(([key, pos]) => (
                            <Node 
                                key={key}
                                id={key}
                                pos={pos}
                                data={loadout[key]}
                                onClick={() => setSelectedNode(key)}
                            />
                        ))}
                    </div>

                    {/* Editor Modal */}
                    {selectedNode && (
                        <EditorModal 
                            nodeId={selectedNode}
                            data={loadout[selectedNode]} 
                            type={INITIAL_LAYOUT[selectedNode].type}
                            label={INITIAL_LAYOUT[selectedNode].label}
                            onClose={() => setSelectedNode(null)}
                            onUpdate={(updates) => handleUpdateNode(selectedNode, updates)}
                        />
                    )}

                    {/* Skill Tester Modal */}
                    {testerOpen && (
                        <SkillTester 
                            loadout={loadout} 
                            stats={stats} 
                            onClose={() => setTesterOpen(false)} 
                        />
                    )}
                </div>
            );
        };

        const Node = ({ id, pos, data, onClick }) => {
            const getTypeColor = () => {
                if (data.type === 'main') return 'border-amber-500 bg-slate-800/90';
                if (data.type === 'secondary') return 'border-emerald-500 bg-slate-800/90';
                if (data.type === 'skill') return 'border-cyan-500 bg-slate-800/90';
                return 'border-purple-500 bg-slate-800/90';
            };

            const getIcon = () => {
                if (data.type === 'skill') return 'fa-bolt';
                if (id.includes('Hand')) return 'fa-khanda';
                if (id.includes('Head')) return 'fa-helmet-safety';
                return 'fa-cube';
            };

            return (
                <div 
                    className={`absolute w-32 h-auto p-2 rounded border-2 shadow-lg cursor-pointer node-card select-none flex flex-col items-center gap-1 ${getTypeColor()}`}
                    style={{ left: pos.x, top: pos.y }}
                    onClick={onClick}
                >
                    <div className="text-xs font-bold uppercase tracking-widest text-slate-400">{pos.label}</div>
                    <div className="w-12 h-12 bg-slate-900 rounded border border-slate-600 flex items-center justify-center mb-1">
                        {/* Placeholder Icon */}
                        <i className={`fas ${getIcon()} text-2xl opacity-50`}></i>
                    </div>
                    <div className="text-xs text-center truncate w-full font-semibold text-white">
                        {data.name || "Empty"}
                    </div>
                    {data.type !== 'skill' && (
                        <div className="flex gap-1 text-[10px]">
                            <span className="text-yellow-500">{data.cr} CR</span>
                        </div>
                    )}
                </div>
            );
        };

        const EditorModal = ({ nodeId, data, type, label, onClose, onUpdate }) => {
            const handleChange = (field, value) => {
                onUpdate({ [field]: value });
            };

            return (
                <div className="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-900 border border-slate-600 w-full max-w-lg rounded-lg shadow-2xl flex flex-col max-h-[90vh]" onClick={e => e.stopPropagation()}>
                        
                        {/* Header */}
                        <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800 rounded-t-lg">
                            <h2 className="text-xl font-bold text-white">Editing <span className="text-cyan-400">{label}</span></h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><i className="fas fa-times text-xl"></i></button>
                        </div>

                        {/* Content */}
                        <div className="p-6 overflow-y-auto custom-scrollbar space-y-6">
                            
                            {/* Name Input */}
                            <div>
                                <label className="block text-xs text-slate-400 uppercase mb-1">Item/Skill Name</label>
                                {type === 'skill' ? (
                                    <select 
                                        className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-cyan-500 outline-none"
                                        value={data.name}
                                        onChange={(e) => handleChange('name', e.target.value)}
                                    >
                                        {SKILLS.map(s => <option key={s.name} value={s.name}>{s.name}</option>)}
                                    </select>
                                ) : (
                                    <input 
                                        type="text" 
                                        className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white focus:border-cyan-500 outline-none"
                                        value={data.name}
                                        onChange={(e) => handleChange('name', e.target.value)}
                                    />
                                )}
                            </div>

                            {/* Type Specific Fields */}
                            {(type === 'main' || type === 'secondary') && (
                                <>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs text-slate-400 uppercase mb-1">Combat Rating (CR)</label>
                                            <input type="number" className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={data.cr} onChange={(e) => handleChange('cr', e.target.value)} />
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-400 uppercase mb-1">Resonance</label>
                                            <input type="number" className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={data.resonance} onChange={(e) => handleChange('resonance', e.target.value)} />
                                        </div>
                                    </div>

                                    {type === 'main' && (
                                        <div>
                                            <label className="block text-xs text-amber-500 uppercase mb-1 font-bold">Legendary Essence</label>
                                            <input 
                                                type="text" 
                                                list="essences"
                                                placeholder="Search or type custom essence..."
                                                className="w-full bg-slate-800 border border-amber-500/50 rounded p-2 text-amber-100 focus:border-amber-500 outline-none"
                                                value={data.essence}
                                                onChange={(e) => handleChange('essence', e.target.value)}
                                            />
                                            <datalist id="essences">
                                                <option value="Inferno IX Essence (Generic)" />
                                                <option value="Geyesers Essence" />
                                                <option value="Leeward" />
                                                <option value="Slippery Shell" />
                                                <option value="United Defiance" />
                                                <option value="Shriekworth" />
                                            </datalist>
                                            <p className="text-[10px] text-slate-500 mt-1">Type new Inferno IX essences here manually if not in list.</p>
                                        </div>
                                    )}

                                    {type === 'secondary' && (
                                        <div>
                                            <label className="block text-xs text-emerald-500 uppercase mb-1 font-bold">Set Item Type</label>
                                            <select 
                                                className="w-full bg-slate-800 border border-emerald-500/50 rounded p-2 text-emerald-100 focus:border-emerald-500 outline-none"
                                                value={data.set}
                                                onChange={(e) => handleChange('set', e.target.value)}
                                            >
                                                <option value="">None</option>
                                                {SET_ITEMS.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select>
                                        </div>
                                    )}

                                    {/* Sockets */}
                                    <div className="bg-slate-800/50 p-4 rounded border border-slate-700">
                                        <label className="block text-xs text-slate-400 uppercase mb-3">Sockets & Properties</label>
                                        
                                        <div className="space-y-3">
                                            <div>
                                                <span className="text-xs text-purple-400">Legendary/Normal Gem</span>
                                                <select className="w-full mt-1 bg-slate-900 border border-slate-700 rounded p-1 text-sm" value={data.gem1 || ""} onChange={(e) => handleChange('gem1', e.target.value)}>
                                                    <option value="">Empty Socket</option>
                                                    {GEMS_LEGENDARY.map(g => <option key={g} value={g}>{g}</option>)}
                                                    <option value="Tourmaline (Damage)">Tourmaline</option>
                                                    <option value="Ruby (Life)">Ruby</option>
                                                    <option value="Sapphire (ArPen)">Sapphire</option>
                                                </select>
                                            </div>
                                            
                                            <div>
                                                <span className="text-xs text-orange-400">Runes</span>
                                                <input type="text" placeholder="e.g. Lit, Feo..." className="w-full mt-1 bg-slate-900 border border-slate-700 rounded p-1 text-sm" value={data.rune || ""} onChange={(e) => handleChange('rune', e.target.value)} />
                                            </div>

                                            <div>
                                                <span className="text-xs text-red-400">Cursed Property</span>
                                                <select className="w-full mt-1 bg-slate-900 border border-slate-700 rounded p-1 text-sm" value={data.curse} onChange={(e) => handleChange('curse', e.target.value)}>
                                                    {CURSED_PROPERTIES.map(c => <option key={c} value={c}>{c}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}

                            {/* Paragon Specific */}
                            {type === 'paragon' && (
                                <div>
                                    <label className="block text-xs text-slate-400 uppercase mb-1">Active Paragon Tree</label>
                                    <select className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white" value={data.tree || "Weaver"} onChange={(e) => handleChange('tree', e.target.value)}>
                                        <option value="Weaver">Weaver</option>
                                        <option value="Gladiator">Gladiator</option>
                                        <option value="Survivor">Survivor</option>
                                        <option value="Vanquisher">Vanquisher</option>
                                        <option value="Treasure Hunter">Treasure Hunter</option>
                                        <option value="Mastermind">Mastermind</option>
                                        <option value="Slinger">Slinger (Tempest Fave)</option>
                                    </select>
                                    <div className="mt-4">
                                        <label className="block text-xs text-slate-400 uppercase mb-1">Active Nodes (Comma separated)</label>
                                        <textarea 
                                            className="w-full h-24 bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm"
                                            value={data.nodes || ""}
                                            onChange={(e) => handleChange('nodes', e.target.value)}
                                            placeholder="e.g. Damage, Health, Armor Pen..."
                                        ></textarea>
                                    </div>
                                </div>
                            )}

                        </div>
                        
                        {/* Footer */}
                        <div className="p-4 border-t border-slate-700 bg-slate-800 rounded-b-lg flex justify-end">
                            <button onClick={onClose} className="bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded font-bold transition">Done</button>
                        </div>
                    </div>
                </div>
            );
        };

        const SkillTester = ({ loadout, stats, onClose }) => {
            // Simple Simulation Logic
            const damageReport = useMemo(() => {
                // Base Damage calculation (Rough approximation for DI)
                const baseDamage = stats.totalCR * 0.1 + stats.totalRes * 0.05 + 1000;
                
                // Find equipped skills
                const equippedSkills = Object.keys(loadout)
                    .filter(k => loadout[k].type === 'skill')
                    .map(k => {
                        const sName = loadout[k].name;
                        return SKILLS.find(s => s.name === sName) || { name: sName, damagePct: 100, cooldown: 0 };
                    });

                return equippedSkills.map(skill => {
                    const skillDmg = Math.floor(baseDamage * (skill.damagePct / 100));
                    return { ...skill, estimatedDmg: skillDmg };
                });
            }, [loadout, stats]);

            return (
                <div className="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-900 border border-slate-600 w-full max-w-2xl rounded-lg shadow-2xl flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                        <div className="p-4 border-b border-slate-700 bg-slate-800 rounded-t-lg">
                            <h2 className="text-xl font-bold text-white"><i className="fas fa-calculator text-cyan-400 mr-2"></i>Skill Damage Simulator</h2>
                            <p className="text-xs text-slate-400 mt-1">Based on Base Attributes, CR, and Skill Multipliers. Does not include complex proc logic.</p>
                        </div>
                        
                        <div className="p-6 overflow-y-auto custom-scrollbar">
                            <div className="mb-6 grid grid-cols-3 gap-4 text-center">
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <div className="text-xs text-slate-400 uppercase">Total CR</div>
                                    <div className="text-xl font-mono text-yellow-500">{stats.totalCR}</div>
                                </div>
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <div className="text-xs text-slate-400 uppercase">Total Resonance</div>
                                    <div className="text-xl font-mono text-purple-400">{stats.totalRes}</div>
                                </div>
                                <div className="bg-slate-800 p-3 rounded border border-slate-700">
                                    <div className="text-xs text-slate-400 uppercase">Est. Base Dmg</div>
                                    <div className="text-xl font-mono text-white">{(stats.totalCR * 0.1 + stats.totalRes * 0.05 + 1000).toFixed(0)}</div>
                                </div>
                            </div>

                            <div className="space-y-2">
                                {damageReport.map((skill, idx) => (
                                    <div key={idx} className="flex justify-between items-center bg-slate-800/50 p-3 rounded border border-slate-700 hover:bg-slate-800 transition">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 rounded bg-cyan-900 flex items-center justify-center text-cyan-200">
                                                <i className="fas fa-wind text-sm"></i>
                                            </div>
                                            <div>
                                                <div className="font-bold text-white">{skill.name}</div>
                                                <div className="text-xs text-slate-400">{skill.type} | {skill.damagePct}% Dmg</div>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-lg font-mono text-cyan-400 font-bold">{skill.estimatedDmg.toLocaleString()}</div>
                                            <div className="text-xs text-slate-500">per hit (est)</div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="mt-6 p-4 bg-emerald-900/20 border border-emerald-700/50 rounded">
                                <h3 className="text-sm font-bold text-emerald-400 mb-2">Active Set Bonuses</h3>
                                {Object.keys(stats.setCounts).length === 0 ? (
                                    <span className="text-xs text-slate-500">No set items equipped.</span>
                                ) : (
                                    <ul className="text-xs text-emerald-200 space-y-1">
                                        {Object.entries(stats.setCounts).map(([set, count]) => (
                                            <li key={set}>
                                                <span className="font-bold">{set}</span>: {count} pieces 
                                                {count >= 2 && <span className="ml-2 opacity-75">(2pc Active)</span>}
                                                {count >= 4 && <span className="ml-2 opacity-75">(4pc Active)</span>}
                                                {count >= 6 && <span className="ml-2 opacity-75">(6pc Active)</span>}
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                        </div>

                        <div className="p-4 border-t border-slate-700 bg-slate-800 rounded-b-lg text-right">
                             <button onClick={onClose} className="bg-slate-600 hover:bg-slate-500 text-white px-4 py-2 rounded">Close</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

